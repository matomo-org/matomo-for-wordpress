(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue")):"function"===typeof define&&define.amd?define(["CoreHome"],t):"object"===typeof exports?exports["CoreVisualizations"]=t(require("CoreHome"),require("vue")):e["CoreVisualizations"]=t(e["CoreHome"],e["Vue"])})("undefined"!==typeof self?self:this,(function(e,t){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="plugins/CoreVisualizations/vue/dist/",n(n.s="fae3")}({"19dc":function(t,n){t.exports=e},"8bbf":function(e,n){e.exports=t},fae3:function(e,t,n){"use strict";if(n.r(t),n.d(t,"SeriesPicker",(function(){return h})),n.d(t,"SingleMetricView",(function(){return T})),"undefined"!==typeof window){var r=window.document.currentScript,o=r&&r.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);o&&(n.p=o[1])}var c=n("19dc"),a=n("8bbf"),l={key:0,class:"jqplot-seriespicker-popover"},i={class:"headline"},u=["onClick"],s=["type","checked"],d={key:0,class:"headline recordsToPlot"},m=["onClick"],p=["type","checked"];function f(e,t,n,r,o,c){return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{class:Object(a["normalizeClass"])(["jqplot-seriespicker",{open:e.isPopupVisible}]),onMouseenter:t[1]||(t[1]=function(t){return e.isPopupVisible=!0}),onMouseleave:t[2]||(t[2]=function(t){return e.onLeavePopup()})},[Object(a["createElementVNode"])("a",{href:"#",onClick:t[0]||(t[0]=Object(a["withModifiers"])((function(){}),["prevent","stop"]))}," + "),e.isPopupVisible?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",l,[Object(a["createElementVNode"])("p",i,Object(a["toDisplayString"])(e.translate(e.multiselect?"General_MetricsToPlot":"General_MetricToPlot")),1),(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.selectableColumns,(function(t){return Object(a["openBlock"])(),Object(a["createElementBlock"])("p",{class:"pickColumn",onClick:function(n){return e.optionSelected(t.column,e.columnStates)},key:t.column},[Object(a["createElementVNode"])("label",null,[Object(a["createElementVNode"])("input",{class:"select",type:e.multiselect?"checkbox":"radio",checked:!!e.columnStates[t.column]},null,8,s),Object(a["createElementVNode"])("span",null,Object(a["toDisplayString"])(t.translation),1)])],8,u)})),128)),e.selectableRows.length?(Object(a["openBlock"])(),Object(a["createElementBlock"])("p",d,Object(a["toDisplayString"])(e.translate("General_RecordsToPlot")),1)):Object(a["createCommentVNode"])("",!0),(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.selectableRows,(function(t){return Object(a["openBlock"])(),Object(a["createElementBlock"])("p",{class:"pickRow",onClick:function(n){return e.optionSelected(t.matcher,e.rowStates)},key:t.matcher},[Object(a["createElementVNode"])("label",null,[Object(a["createElementVNode"])("input",{class:"select",type:e.multiselect?"checkbox":"radio",checked:!!e.rowStates[t.matcher]},null,8,p),Object(a["createElementVNode"])("span",null,Object(a["toDisplayString"])(t.label),1)])],8,m)})),128))])):Object(a["createCommentVNode"])("",!0)],34)}function b(e,t){var n={};return e.forEach((function(e){var t=e.column||e.matcher;n[t]=!1})),t.forEach((function(e){n[e]=!0})),n}function v(e,t){return e.length===t.length&&0===e.filter((function(e){return-1===t.indexOf(e)})).length}function g(e){Object.keys(e).forEach((function(t){e[t]=!1}))}function j(e){return Object.keys(e).filter((function(t){return!!e[t]}))}var O=Object(a["defineComponent"])({props:{multiselect:Boolean,selectableColumns:{type:Array,default:function(){return[]}},selectableRows:{type:Array,default:function(){return[]}},selectedColumns:{type:Array,default:function(){return[]}},selectedRows:{type:Array,default:function(){return[]}}},data:function(){return{isPopupVisible:!1,columnStates:b(this.selectableColumns,this.selectedColumns),rowStates:b(this.selectableRows,this.selectedRows)}},emits:["select"],created:function(){this.optionSelected=Object(c["debounce"])(this.optionSelected,0)},methods:{optionSelected:function(e,t){this.multiselect||(g(this.columnStates),g(this.rowStates)),t[e]=!t[e],this.triggerOnSelectAndClose()},onLeavePopup:function(){this.isPopupVisible=!1,this.optionsChanged()&&this.triggerOnSelectAndClose()},triggerOnSelectAndClose:function(){this.isPopupVisible=!1,this.$emit("select",{columns:j(this.columnStates),rows:j(this.rowStates)})},optionsChanged:function(){return!v(j(this.columnStates),this.selectedColumns)||!v(j(this.rowStates),this.selectedRows)}}});O.render=f;var h=O,y=(Object(c["createAngularJsAdapter"])({component:h,scope:{multiselect:{angularJsBind:"<"},selectableColumns:{angularJsBind:"<"},selectableRows:{angularJsBind:"<"},selectedColumns:{angularJsBind:"<"},selectedRows:{angularJsBind:"<"},onSelect:{angularJsBind:"&",vue:"select"}},directiveName:"piwikSeriesPicker",restrict:"E"}),{class:"metric-sparkline"}),w={class:"metric-value"},S=["title"],k=["title"];
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */function C(e,t,n,r,o,c){var l=Object(a["resolveComponent"])("Sparkline");return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{class:Object(a["normalizeClass"])(["singleMetricView",{loading:e.isLoading}]),ref:"root"},[Object(a["createElementVNode"])("div",y,[Object(a["createVNode"])(l,{params:e.sparklineParams},null,8,["params"])]),Object(a["createElementVNode"])("div",w,[Object(a["createElementVNode"])("span",{title:e.metricDocumentation},[Object(a["createElementVNode"])("strong",null,Object(a["toDisplayString"])(e.metricValue),1),Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])((e.metricTranslation||"").toLowerCase()),1)],8,S),null!==e.pastValue?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",{key:0,class:"metricEvolution",title:e.translate("General_EvolutionSummaryGeneric",e.metricValue,e.currentPeriod,e.pastValue,e.pastPeriod,e.metricChangePercent)},[Object(a["createElementVNode"])("span",{class:Object(a["normalizeClass"])({"positive-evolution":e.metricValueUnformatted>e.pastValueUnformatted,"negative-evolution":e.metricValueUnformatted<e.pastValueUnformatted})},Object(a["toDisplayString"])(e.metricChangePercent),3)],8,k)):Object(a["createCommentVNode"])("",!0)])],2)}function V(e,t){return N(e)||M(e,t)||P(e,t)||E()}function E(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function P(e,t){if(e){if("string"===typeof e)return B(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?B(e,t):void 0}}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function M(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(r=n.next()).done);a=!0)if(c.push(r.value),t&&c.length===t)break}catch(i){l=!0,o=i}finally{try{a||null==n["return"]||n["return"]()}finally{if(l)throw o}}return c}}function N(e){if(Array.isArray(e))return e}function A(){var e=c["Range"].getLastNRange(c["Matomo"].period,2,c["Matomo"].currentDateString),t=e.startDate,n=c["Periods"].get(c["Matomo"].period).parse(t).getDateRange();return"".concat(Object(c["format"])(n[0]),",").concat(Object(c["format"])(n[1]))}var _=window,D=_.$,x=Object(a["defineComponent"])({props:{metric:{type:String,required:!0},idGoal:[String,Number],metricTranslations:{type:Object,required:!0},metricDocumentations:Object,goals:{type:Object,required:!0},goalMetrics:Array},components:{Sparkline:c["Sparkline"]},setup:function(e){var t=Object(a["ref"])(null),n=Object(a["ref"])(!1),r=Object(a["ref"])(null),o=Object(a["ref"])(e.metric),l=Object(a["ref"])(e.idGoal),i=Object(a["computed"])((function(){return[l.value?"goal".concat(l.value,"_").concat(o.value):o.value]})),u=Object(a["computed"])((function(){var e;return null!==(e=r.value)&&void 0!==e&&e[1]?r.value[1][o.value]:null})),s=Object(a["computed"])((function(){var e;return null!==(e=r.value)&&void 0!==e&&e[2]?r.value[2][o.value]||0:null})),d=Object(a["computed"])((function(){if(!u.value)return null;var e="string"===typeof u.value?parseInt(u.value,10):u.value,t="string"===typeof s.value?parseInt(s.value,10):s.value,n=c["Matomo"].helper.calculateEvolution(e,t);return"".concat((100*n).toFixed(2)," %")})),m=Object(a["computed"])((function(){var e;if(null===(e=r.value)||void 0===e||!e[3])return null;var t=r.value[3];return t[o.value]||0})),p=Object(a["computed"])((function(){var e;if(null===(e=r.value)||void 0===e||!e[0])return null;var t=r.value[0];return t[o.value]||0})),f=Object(a["computed"])((function(){var t;return null!==(t=e.metricTranslations)&&void 0!==t&&t[o.value]?e.metricTranslations[o.value]:""})),b=Object(a["computed"])((function(){var t;return null!==(t=e.metricDocumentations)&&void 0!==t&&t[o.value]?e.metricDocumentations[o.value]:""})),v=Object(a["computed"])((function(){return c["Matomo"].startDateString===c["Matomo"].endDateString?c["Matomo"].endDateString:"".concat(c["Matomo"].startDateString,", ").concat(c["Matomo"].endDateString)}));function g(){return l.value||0===l.value}var j,O=Object(a["computed"])((function(){var e={module:"API",action:"get",columns:o.value};return g()&&(e.idGoal=l.value,e.module="Goals"),e})),y=Object(a["computed"])((function(){if("range"!==c["Matomo"].period)return A()})),w=Object(a["computed"])((function(){var t=[];return Object.keys(e.metricTranslations).forEach((function(n){t.push({column:n,translation:e.metricTranslations[n]})})),Object.values(e.goals||{}).forEach((function(n){e.goalMetrics.forEach((function(r){t.push({column:"goal".concat(n.idgoal,"_").concat(r),translation:"".concat(n.name," - ").concat(e.metricTranslations[r])})}))})),t}));function S(){var n=f.value;if(g()){var r,o=(null===(r=e.goals[l.value])||void 0===r?void 0:r.name)||Object(c["translate"])("General_Unknown");n="".concat(o," - ").concat(n)}D(t.value).closest("div.widget").find(".widgetTop > .widgetName > span").text(n)}function k(){var e=c["Range"].getLastNRange(c["Matomo"].period,2,c["Matomo"].currentDateString);return Object(c["format"])(e.startDate)}function C(){n.value=!0;var e=[],t="API",o="get",a={};g()&&(a.idGoal=l.value,a.filter_add_columns_when_show_all_columns=0,t="Goals",o="get");var i="".concat(t,".").concat(o);return e.push(c["AjaxHelper"].fetch(Object.assign({method:i,format_metrics:"all"},a))),"range"!==c["Matomo"].period&&(e.push(c["AjaxHelper"].fetch(Object.assign({method:i,format_metrics:"0"},a))),e.push(c["AjaxHelper"].fetch(Object.assign({method:i,date:k(),format_metrics:"0"},a))),e.push(c["AjaxHelper"].fetch(Object.assign({method:i,date:k(),format_metrics:"all"},a)))),Promise.all(e).then((function(e){r.value=e,n.value=!1}))}function E(e){o.value=e,C().then(S),D(t.value).closest("[widgetId]").trigger("setParameters",{column:o.value,idGoal:l.value})}function P(e){var t=void 0,n=e,r=e.match(/^goal([0-9]+)_(.*)/);if(r){t=+r[1];var c=V(r,3);n=c[2]}o.value===n&&t===l.value||(o.value=n,l.value=t,E(n))}function B(){var e=D(t.value),n=e.closest("div.widget").find(".widgetTop > .widgetName"),r=D('<div class="single-metric-view-picker"><div></div></div>'),o=Object(c["createVueApp"])({render:function(){return Object(a["createVNode"])(h,{multiselect:!1,selectableColumns:w.value,selectableRows:[],selectedColumns:i.value,selectedRows:[],onSelect:function(e){var t=e.columns;P(t[0])}})}});return n.append(r),o.mount(r.children()[0]),o}return Object(a["onMounted"])((function(){j=B()})),Object(a["onBeforeUnmount"])((function(){D(t.value).closest(".widgetContent").off("widget:destroy").off("widget:reload"),D(t.value).closest("div.widget").find(".single-metric-view-picker").remove(),j.unmount()})),Object(a["watch"])((function(){return e.metric}),(function(){E(e.metric)})),E(e.metric),{root:t,metricValue:p,isLoading:n,selectedColumns:i,responses:r,metricValueUnformatted:u,pastValueUnformatted:s,metricChangePercent:d,pastValue:m,metricTranslation:f,metricDocumentation:b,sparklineParams:O,pastPeriod:y,selectableColumns:w,currentPeriod:v}}});x.render=C;var T=x;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */Object(c["createAngularJsAdapter"])({component:T,scope:{metric:{angularJsBind:"<"},idGoal:{angularJsBind:"<"},metricTranslations:{angularJsBind:"<"},metricDocumentations:{angularJsBind:"<"},goals:{angularJsBind:"<"},goalMetrics:{angularJsBind:"<"}},directiveName:"piwikSingleMetricView",restrict:"E",postCreate:function(e,t,n){n.closest(".widgetContent").on("widget:destroy",(function(){t.$parent.$destroy()})).on("widget:reload",(function(){t.$parent.$destroy()}))}})}})}));
//# sourceMappingURL=CoreVisualizations.umd.min.js.map