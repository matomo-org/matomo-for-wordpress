(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin"],t):"object"===typeof exports?exports["JsTrackerInstallCheck"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):e["JsTrackerInstallCheck"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"])})("undefined"!==typeof self?self:this,(function(e,t,s){return function(e){var t={};function s(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="plugins/JsTrackerInstallCheck/vue/dist/",s(s.s="fae3")}({"19dc":function(t,s){t.exports=e},"8bbf":function(e,s){e.exports=t},a5a2:function(e,t){e.exports=s},fae3:function(e,t,s){"use strict";if(s.r(t),s.d(t,"JsTrackerInstallCheck",(function(){return O})),"undefined"!==typeof window){var n=window.document.currentScript,r=n&&n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);r&&(s.p=r[1])}var c=s("8bbf"),i={class:"jsTrackerInstallCheck"},o={class:"row testInstallFields"},a={class:"col s2"},l={class:"col s10"},u=["disabled","value"],d={class:"system-success success-message"},h=Object(c["createElementVNode"])("span",{class:"icon-ok"},null,-1),f={class:"system-errors test-error"},p=Object(c["createElementVNode"])("span",{class:"icon-warning"},null,-1),m=Object(c["createTextVNode"])("Â  "),T=["innerHTML"];function b(e,t,s,n,r,b){var k=Object(c["resolveComponent"])("Field"),g=Object(c["resolveComponent"])("ActivityIndicator");return Object(c["openBlock"])(),Object(c["createElementBlock"])(c["Fragment"],null,[Object(c["createElementVNode"])("span",null,Object(c["toDisplayString"])(e.translate("JsTrackerInstallCheck_TestInstallationDescription")),1),Object(c["createElementVNode"])("div",i,[Object(c["createElementVNode"])("div",o,[Object(c["createElementVNode"])("div",a,[Object(c["createVNode"])(k,{uicontrol:"url",name:"baseUrl",placeholder:"https://example.com",modelValue:e.baseUrl,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.baseUrl=t}),"full-width":!0,disabled:e.isTesting},null,8,["modelValue","disabled"])]),Object(c["createElementVNode"])("div",l,[Object(c["createElementVNode"])("input",{type:"button",class:"btn testInstallBtn",onClick:t[1]||(t[1]=function(){return e.initiateTrackerTest&&e.initiateTrackerTest.apply(e,arguments)}),disabled:!e.baseUrl||e.isTesting,value:e.translate("JsTrackerInstallCheck_TestInstallationBtnText")},null,8,u)])]),Object(c["createVNode"])(g,{loading:e.isTesting,loadingMessage:e.translate("General_Testing")},null,8,["loading","loadingMessage"]),Object(c["withDirectives"])(Object(c["createElementVNode"])("div",d,[h,Object(c["createTextVNode"])(" "+Object(c["toDisplayString"])(e.translate("JsTrackerInstallCheck_JsTrackingCodeInstallCheckSuccessMessage")),1)],512),[[c["vShow"],e.isTestSuccess]]),Object(c["withDirectives"])(Object(c["createElementVNode"])("div",f,[p,m,Object(c["createElementVNode"])("span",{innerHTML:e.$sanitize(e.getTestFailureMessage)},null,8,T)],512),[[c["vShow"],e.isTestComplete&&!e.isTestSuccess]])])],64)}var k=s("19dc"),g=s("a5a2"),C=10,j=1e3,v=Object(c["defineComponent"])({components:{Field:g["Field"],ActivityIndicator:k["ActivityIndicator"]},data:function(){return{checkNonce:"",isTesting:!1,isTestComplete:!1,isTestSuccess:!1,testTimeoutCount:0,baseUrl:""}},props:{site:{type:Object,required:!0},isWordpress:{type:Boolean,required:!1,default:!1}},created:function(){this.checkWhetherSuccessWasRecorded()},watch:{site:function(){this.onSiteChange()}},methods:{onSiteChange:function(){this.checkNonce="",this.isTesting=!1,this.isTestComplete=!1,this.isTestSuccess=!1,this.testTimeoutCount=0,this.checkWhetherSuccessWasRecorded()},initiateTrackerTest:function(){var e=this;this.isTesting=!0,this.isTestComplete=!1,this.isTestSuccess=!1,this.testTimeoutCount=0;var t=this.site,s={idSite:t.id,url:""};this.baseUrl&&(s.url=this.baseUrl),k["AjaxHelper"].post({module:"API",method:"JsTrackerInstallCheck.initiateJsTrackerInstallTest"},s).then((function(t){var s=t&&t.url&&t.nonce;if(s){e.checkNonce=t.nonce;var n=window.open(t.url);e.setCheckInTime(),setTimeout((function(){n&&!n.closed&&(n.close(),e.testTimeoutCount=C)}),C*j)}})).catch((function(){e.isTesting=!1}))},setCheckInTime:function(){setTimeout(this.checkWhetherSuccessWasRecorded,j)},checkWhetherSuccessWasRecorded:function(){var e=this,t=this.site,s={idSite:t.id,nonce:""};this.checkNonce&&(s.nonce=this.checkNonce),k["AjaxHelper"].post({module:"API",method:"JsTrackerInstallCheck.wasJsTrackerInstallTestSuccessful"},s).then((function(t){if(t&&t.mainUrl&&!e.baseUrl&&(e.baseUrl=t.mainUrl),e.isTestSuccess=t&&t.isSuccess,e.checkNonce&&!e.isTestSuccess&&e.testTimeoutCount<C)return e.testTimeoutCount+=1,void e.setCheckInTime();e.isTestComplete=!!e.checkNonce,e.isTesting=!1})).catch((function(){e.isTesting=!1}))}},computed:{getTestFailureMessage:function(){var e=Object(k["externalLink"])("https://matomo.org/faq/troubleshooting/faq_58/"),t="</a>";return this.isWordpress?Object(k["translate"])("JsTrackerInstallCheck_JsTrackingCodeInstallCheckFailureMessageWordpress",'<a target="_blank" rel="noreferrer noopener" href="https://wordpress.org/plugins/wp-piwik/">WP-Matomo Integration (WP-Piwik)</a>',e,t):Object(k["translate"])("JsTrackerInstallCheck_JsTrackingCodeInstallCheckFailureMessage",e,t)}}});v.render=b;var O=v;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */}})}));
//# sourceMappingURL=JsTrackerInstallCheck.umd.min.js.map